# Tesouro Direto â€“ AutomaÃ§Ã£o de PreÃ§os (PU de Resgate)

Este repositÃ³rio contÃ©m uma automaÃ§Ã£o completa para **atualizaÃ§Ã£o e versionamento dos preÃ§os unitÃ¡rios (PU de resgate) do Tesouro Direto**, com integraÃ§Ã£o entre:

- Download manual do CSV do site oficial (https://www.tesourodireto.com.br/produtos/dados-sobre-titulos/rendimento-dos-titulos)
- AutomaÃ§Ã£o local no macOS
- Versionamento no GitHub
- Consumo automÃ¡tico via Google Sheets (Apps Script)

O objetivo principal Ã© **bater exatamente com o valor exibido pela corretora**, utilizando **marcaÃ§Ã£o a mercado (PU de resgate)**.

---

## ğŸ¯ Objetivo do Projeto

- Permitir a atualizaÃ§Ã£o automÃ¡tica dos preÃ§os unitÃ¡rios dos tÃ­tulos do tesouro em carteira
- Centralizar uma **fonte confiÃ¡vel e versionada** dos preÃ§os do Tesouro Direto
- Automatizar ao mÃ¡ximo o processo, mantendo controle e auditabilidade

---

## ğŸ“Œ PrincÃ­pio Fundamental

> O valor patrimonial do Tesouro Direto deve ser calculado com base no  
> **PreÃ§o UnitÃ¡rio de Resgate (PU de resgate)**, que reflete a marcaÃ§Ã£o a mercado.

Por isso, **este projeto utiliza exclusivamente o arquivo**: rendimento-resgatar.csv

## ğŸ§± Arquitetura Geral

```text
Tesouro Direto (site oficial)
        â†“
Download manual do CSV (rendimento-resgatar.csv)
        â†“
macOS Automator (Folder Action)
        â†“
Script Bash (atualizar_td.sh)
        â†“
GitHub (repositÃ³rio versionado)
        â†“
Google Apps Script
        â†“
Google Sheets (aba Tesouro Direto (Source) protegida)
        â†“
Planilha de controle da carteira

â¸»

ğŸ“‚ Estrutura do RepositÃ³rio

tesouro-direto-dados/
â”œâ”€â”€ atualizar_td.sh          # Script principal de automaÃ§Ã£o
â”œâ”€â”€ precos/
â”‚   â””â”€â”€ rendimento-resgatar.csv
â”œâ”€â”€ log/
â”‚   â””â”€â”€ atualizar_td.log     # Log versionado das execuÃ§Ãµes
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md

â¸»

âš™ï¸ Componentes do Sistema

1ï¸âƒ£ Download Manual (Ponto de Controle)
	â€¢	O arquivo rendimento-resgatar.csv Ã© baixado manualmente do site oficial do Tesouro Direto
	â€¢	Essa decisÃ£o Ã© intencional, priorizando:
	â€¢	estabilidade
	â€¢	previsibilidade
	â€¢	conformidade com a fonte oficial

â¸»

2ï¸âƒ£ AutomaÃ§Ã£o Local (Automator macOS)

ğŸ”¹ Script Bash â€“ atualizar_td.sh
Responsabilidades:
	â€¢	Detectar o CSV na pasta Downloads
	â€¢	Copiar o arquivo para precos/
	â€¢	Remover o arquivo da pasta Downloads apÃ³s cÃ³pia bem-sucedida
	â€¢	Registrar todas as aÃ§Ãµes em log
	â€¢	Executar git add, commit e push automaticamente

Logs:
	â€¢	Gravados em log/atualizar_td.log
	â€¢	Versionados no Git para auditoria histÃ³rica

â¸»

ğŸ”¹ Automator (Folder Action)
	â€¢	Observa a pasta Downloads
	â€¢	Dispara automaticamente o script quando o arquivo: rendimento-resgatar.csv

aparece na pasta

Resultado:
	â€¢	Nenhuma aÃ§Ã£o manual alÃ©m do download
	â€¢	Fluxo local totalmente automÃ¡tico

â¸»

3ï¸âƒ£ GitHub (Fonte CanÃ´nica)

O GitHub funciona como:
	â€¢	Fonte Ãºnica de verdade
	â€¢	HistÃ³rico completo de mudanÃ§as
	â€¢	Ponte entre o ambiente local e o Google Sheets

A planilha nunca depende diretamente do computador local.

â¸»

4ï¸âƒ£ Google Apps Script

FunÃ§Ã£o principal:
	â€¢	atualizarTesouroDiretoSource()

Responsabilidades:
	â€¢	Buscar o CSV diretamente do GitHub (raw)
	â€¢	Popular a aba Tesouro Direto (Source) com dados crus
	â€¢	Registrar metadados:
	â€¢	Data da Ãºltima execuÃ§Ã£o
	â€¢	Data do Ãºltimo commit do CSV
	â€¢	Aplicar formataÃ§Ã£o de data/hora
	â€¢	Aplicar indicador visual de â€œdados antigosâ€
	â€¢	Proteger automaticamente a aba contra ediÃ§Ã£o manual

â¸»

5ï¸âƒ£ Google Sheets

ğŸ”¹ Aba: Tesouro Direto (Source)
	â€¢	ContÃ©m dados crus, sem fÃ³rmulas
	â€¢	Ã‰ automaticamente protegida
	â€¢	Serve exclusivamente como fonte para:
	â€¢	PROCX / XLOOKUP
	â€¢	cÃ¡lculos da carteira
	â€¢	consolidaÃ§Ãµes

Metadados visÃ­veis:
	â€¢	Data da Ãºltima execuÃ§Ã£o do script
	â€¢	Data do Ãºltimo commit no GitHub
	â€¢	Indicador visual de atualizaÃ§Ã£o (verde / amarelo / vermelho)

â¸»

ğŸ” ProteÃ§Ãµes e SeguranÃ§a
	â€¢	Aba Tesouro Direto (Source) Ã© protegida contra ediÃ§Ã£o manual
	â€¢	Apps Script mantÃ©m permissÃ£o total de escrita
	â€¢	Logs permitem auditoria e diagnÃ³stico ao longo do tempo

â¸»

â±ï¸ Disparo do Google Apps Script
	â€¢	Disparo baseado em tempo (time-driven trigger)
	â€¢	FrequÃªncia recomendada:
	â€¢	1x por dia
	â€¢	O script Ã© idempotente:
	â€¢	se o CSV nÃ£o mudou, nada quebra
	â€¢	se mudou, a planilha reflete automaticamente

â¸»

âœ… DecisÃµes de Design Importantes
	â€¢	âŒ NÃ£o usar scraping
	â€¢	âŒ NÃ£o depender de APIs instÃ¡veis
	â€¢	âŒ NÃ£o automatizar login em site oficial
	â€¢	âœ… Usar apenas dados oficiais
	â€¢	âœ… Separar dados (SOURCE) de cÃ¡lculo (carteira)
	â€¢	âœ… Priorizar clareza e manutenÃ§Ã£o de longo prazo

â¸»

ğŸ“Œ ConclusÃ£o

Este repositÃ³rio implementa uma automaÃ§Ã£o simples, robusta e auditÃ¡vel para controle de preÃ§os do Tesouro Direto, com foco em:
	â€¢	confiabilidade
	â€¢	aderÃªncia Ã  corretora
	â€¢	manutenÃ§Ã£o de longo prazo
	â€¢	mÃ­nima dependÃªncia externa

O sistema foi projetado para continuar funcional e compreensÃ­vel mesmo apÃ³s anos sem manutenÃ§Ã£o.

---